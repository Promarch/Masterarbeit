<mujoco model="fr3 scene">
  <!-- <include file="knee/knee.xml"/>
  <include file="knee/femur.xml"/> -->
  <include file="knee/knee_assets.xml"/>
  <include file="knee/knee_tendons.xml"/>
  
  <statistic center="0.2 0 0.4" extent=".8"/>

  <default>
    <default class="translation">
      <motor ctrlrange="-30 30" />
    </default>
    <default class="rotation">
      <motor ctrlrange="-4 4"/>
    </default>
  </default>

  <visual>
    <headlight diffuse="0.6 0.6 0.6" ambient="0.3 0.3 0.3" specular="0 0 0"/>
    <rgba haze="0.15 0.25 0.35 1"/>
    <global azimuth="50" elevation="-10"/>
  </visual>

  <asset>
    <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512" height="3072"/>
    <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4" rgb2="0.1 0.2 0.3"
      markrgb="0.8 0.8 0.8" width="300" height="300"/>
    <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5" reflectance="0.2"/>
  </asset>

  <worldbody>
    <light pos="0 0 1.5" dir="0 0 -1" directional="true"/>
    <geom name="floor" size="0 0 0.05" type="plane" material="groundplane"/>
    <site name = "world_site" type="sphere" size="0.01" rgba="0 0 1 1" group="1"/>

    <!-- - - - - - - - - - - - - -->
    <!--           Femur         -->
    <!-- - - - - - - - - - - - - -->
    <body name="femur" pos="0.00 0.00 0.00" quat="0 1 0 0">
      <joint type="free" />

      <geom class="visuals" euler="0 0 0" mesh="femur mesh" pos="0 0 0" type="mesh" />
      <site name="attachment_site2" rgba="0 1 1 1" size="0.005" group="1" quat="0 0.7071068 0.7071068 0" pos="0.05 0.175 -0.325" />
      <inertial
        fullinertia="0.0014471221093789871 0.0013713473639596421 0.00026087716802195016 7.836769453642076e-08 0.00014400130245007057 -4.208930881634612e-05"
        mass="0.5077506167421568"
        pos="0.04206533826380333 0.17074902085470534 -0.2976383647493416" />
          
      <body euler="0 0 0" name="patella" pos="0 0 0">
        <inertial
          fullinertia="8.050437146859407e-06 5.03777796133191e-06 5.09380183916241e-06 -8.36996939378859e-09 -1.6579383500434607e-07 -6.20224511993419e-07"
          mass="0.04051128232783104"
          pos="0.08702158919851656 0.17917502947062694 -0.33507166780519526" />
        <geom class="visuals" euler="0 0 0" mesh="patella mesh" pos="0 0 0" type="mesh" />
        <geom class="collisions" mesh="patella_0" name="patella_0" type="mesh" />
        <geom class="collisions" mesh="patella_1" name="patella_1" type="mesh" />
        <geom class="collisions" mesh="patella_2" name="patella_2" type="mesh" />
      </body>

      <site name="dMCL_start" pos="0.036439365386962894 0.1270460662841797 -0.34141748046875003" size="0.001" type="sphere" />
      <site name="HKB_start" pos="0.03266553115844727 0.1627947235107422 -0.33516192626953123" size="0.001" type="sphere" />
      <site name="LCL_start" pos="0.03787437820434571 0.21168870544433593 -0.3351375732421875" size="0.001" type="sphere" />
      <site name="POL_start" pos="0.03512559509277344 0.12541929626464843 -0.3359316101074219" size="0.001" type="sphere" />
      <site name="PS_start" pos="0.036873523712158206 0.20842341613769533 -0.3415344543457031" size="0.001" type="sphere" />
      <site name="sMCL_start" pos="0.038979415893554685 0.12602641296386718 -0.33768609619140627" size="0.001" type="sphere" />
      <site name="VKB_start" pos="0.028822696685791016 0.17497718811035157 -0.3328540344238281" size="0.001" type="sphere" />
      <site name="LP_start" pos="0.08642813873291016 0.18136546325683595 -0.3579686584472656" size="0.001" type="sphere" />

      <geom class="collisions" mesh="femur_0" name="femur_0" type="mesh" />
      <geom class="collisions" mesh="femur_1" name="femur_1" type="mesh" />
      <geom class="collisions" mesh="femur_2" name="femur_2" type="mesh" />
      <geom class="collisions" mesh="femur_3" name="femur_3" type="mesh" />
      <geom class="collisions" mesh="femur_4" name="femur_4" type="mesh" />
      <geom class="collisions" mesh="femur_5" name="femur_5" type="mesh" />
      <geom class="collisions" mesh="femur_6" name="femur_6" type="mesh" />
      <geom class="collisions" mesh="femur_7" name="femur_7" type="mesh" />
      <geom class="collisions" mesh="femur_8" name="femur_8" type="mesh" />
      <geom class="collisions" mesh="femur_9" name="femur_9" type="mesh" />

    </body>

    <!-- - - - - - - - - - - - - -->
    <!--           Tibia         -->
    <!-- - - - - - - - - - - - - -->
    <body name="tibia" pos="0.0 0.00 0.5" quat="1 0 0 0">
      <geom class="visuals" euler="0 0 0" mesh="tibia mesh" pos="0 0 0" type="mesh" />
      <inertial
        fullinertia="0.0008780700528212282 0.000882003973073614 0.00018810237832225102 -2.0773214139677317e-05 -0.00017248916504192767 -0.00011027907295235728"
        mass="0.4452526927806469"
        pos="0.035537882962384665 0.1738143285325765 -0.42422270065004697" />

      <body euler="0 0 0" name="fibula" pos="0 0 0">
        <inertial
          fullinertia="6.414713658940696e-05 6.720841419660586e-05 5.044916367991743e-06 8.273971128515786e-07 -1.4502261752779585e-05 3.717336306071836e-06"
          mass="0.03620870310593307"
          pos="0.008065118114846828 0.21070770784463308 -0.4292249651398537" />
        <geom class="visuals" euler="0 0 0" mesh="fibula mesh" pos="0 0 0" type="mesh" />
        <geom class="collisions" mesh="fibula_0" name="fibula_0" type="mesh" />
        <geom class="collisions" mesh="fibula_1" name="fibula_1" type="mesh" />
        <geom class="collisions" mesh="fibula_2" name="fibula_2" type="mesh" />
        <geom class="collisions" mesh="fibula_3" name="fibula_3" type="mesh" />
        <geom class="collisions" mesh="fibula_4" name="fibula_4" type="mesh" />
        <geom class="collisions" mesh="fibula_5" name="fibula_5" type="mesh" />
        <geom class="collisions" mesh="fibula_6" name="fibula_6" type="mesh" />
        <geom class="collisions" mesh="fibula_7" name="fibula_7" type="mesh" />
        <geom class="collisions" mesh="fibula_8" name="fibula_8" type="mesh" />
        <geom class="collisions" mesh="fibula_9" name="fibula_9" type="mesh" />
        <geom class="collisions" mesh="fibula_10" name="fibula_10" type="mesh" />
        <geom class="collisions" mesh="fibula_11" name="fibula_11" type="mesh" />
        <geom class="collisions" mesh="fibula_12" name="fibula_12" type="mesh" />
        <geom class="collisions" mesh="fibula_13" name="fibula_13" type="mesh" />
        <geom class="collisions" mesh="fibula_14" name="fibula_14" type="mesh" />
      </body>
      
      <site name="dMCL_end" pos="0.03582199096679688 0.13370420837402344 -0.37326898193359376" size="0.001" type="sphere" />
      <site name="HKB_end" pos="0.017896549224853515 0.17780065917968751 -0.36857818603515624" size="0.001" type="sphere" />
      <site name="LCL_end" pos="0.019021478652954102 0.2215125274658203 -0.390551513671875" size="0.001" type="sphere" />
      <site name="LCL_end_tibia" pos="0.045 0.200 -0.400" size="0.001" type="sphere" />
      <site name="POL_end" pos="0.024396358489990236 0.13385227966308594 -0.37165481567382813" size="0.001" type="sphere" />
      <site name="PS_end" pos="0.015489018440246582 0.16296687316894531 -0.3892603149414063" size="0.001" type="sphere" />
      <site name="sMCL_end" pos="0.03592108917236328 0.13487907409667968 -0.3777944641113281" size="0.001" type="sphere" />
      <site name="VKB_end" pos="0.04289450454711914 0.17654144287109375 -0.36209667968750003" size="0.001" type="sphere" />
      <site name="LP_end" pos="0.07079630279541016 0.18260380554199218 -0.40183831787109375" size="0.001" type="sphere" />

      <geom class="collisions" mesh="tibia_0" name="tibia_0" type="mesh" />
      <geom class="collisions" mesh="tibia_1" name="tibia_1" type="mesh" />
      <geom class="collisions" mesh="tibia_2" name="tibia_2" type="mesh" />
      <geom class="collisions" mesh="tibia_3" name="tibia_3" type="mesh" />
      <geom class="collisions" mesh="tibia_4" name="tibia_4" type="mesh" />
      <geom class="collisions" mesh="tibia_5" name="tibia_5" type="mesh" />
      <geom class="collisions" mesh="tibia_6" name="tibia_6" type="mesh" />
      <geom class="collisions" mesh="tibia_7" name="tibia_7" type="mesh" />
      <geom class="collisions" mesh="tibia_8" name="tibia_8" type="mesh" />
      <geom class="collisions" mesh="tibia_9" name="tibia_9" type="mesh" />
      <geom class="collisions" mesh="tibia_10" name="tibia_10" type="mesh" />
      <geom class="collisions" mesh="tibia_11" name="tibia_11" type="mesh" />
      <geom class="collisions" mesh="tibia_12" name="tibia_12" type="mesh" />

      <!-- <geom class="visuals"
        type="cylinder" fromto="0.048301631927490235 0.21166104125976562 -0.3733244934082031 0.04652249145507813 0.13440820312500001 -0.3769089660644531"
        name="PS_wrap" rgba=".2 .2 .5 0.8" size="0.025"/> -->
      <geom class="visuals"
        type="cylinder" fromto="0.060 0.198 -0.378 0.018 0.198 -0.378"
        name="LCL_wrap" rgba=".2 .2 .5 0.8" size="0.013"/>
        
      <geom class="visuals"
        type="cylinder" fromto="0.050 0.141 -0.372 0.020 0.141 -0.372"
        name="MCL_wrap" rgba=".2 .2 .5 0.8" size="0.007"/>
        <!-- pos="0.035 0.143 -0.37" size="0.017 0.01 0.004" -->
    </body>

  </worldbody>

  <!-- - - - - - - - - - - - - -->
  <!--        Actuators        -->
  <!-- - - - - - - - - - - - - -->
   <!-- refsite="world_site" -->
  <actuator>
    <motor name="F_x" site="attachment_site2" refsite="world_site" gear="1 0 0 0 0 0" class="translation"/>
    <motor name="F_y" site="attachment_site2" refsite="world_site" gear="0 1 0 0 0 0" class="translation"/>
    <motor name="F_z" site="attachment_site2" refsite="world_site" gear="0 0 1 0 0 0" class="translation"/>
    <motor name="tau_x" site="attachment_site2" refsite="world_site" gear="0 0 0 1 0 0" class="rotation"/>
    <motor name="tau_y" site="attachment_site2" refsite="world_site" gear="0 0 0 0 1 0" class="rotation"/>
    <motor name="tau_z" site="attachment_site2" refsite="world_site" gear="0 0 0 0 0 1" class="rotation"/>
    <motor name="tendon stiffness" site="world_site" ctrlrange="10 4000"/>
    <motor name="debug" site="world_site" ctrlrange="0.01 0.1"/>
    <motor name="L_ACL" site="world_site" ctrlrange="0.01 0.08"/>
    <motor name="L_PCL" site="world_site" ctrlrange="0.01 0.08"/>
    <motor name="L_sMCL" site="world_site" ctrlrange="0.01 0.08"/>
    <motor name="L_LCL" site="world_site" ctrlrange="0.01 0.08"/>
  </actuator>

  <sensor>
    <tendonpos name="ACL" tendon="ACL"/>
    <tendonpos name="PCL" tendon="PCL"/>
    <tendonpos name="sMCL" tendon="sMCL"/>
    <tendonpos name="LCL" tendon="LCL"/>
  </sensor>

  <keyframe>
    <key name="start" qpos='0.0 0.0 0.5 0.0 0.0 0.0 0.0' ctrl="0 0 0 0 0 0 0 0.072 0.018 0.035 0.045 0.072"/>
  </keyframe>
    <!-- <key name="start" qpos='-0.0 0.0 0.5 0.0 -0.0 -0.0 -0.0' qpos='-0.261076 0.115152 -0.0813861 0.443067 -0.133093 -0.880049 -0.107201' ctrl="0 0 0 0 0 0 0"/> -->

</mujoco>
